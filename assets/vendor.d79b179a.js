function M(){}function R(s){return s()}function _(){return Object.create(null)}function D(s){s.forEach(R)}function I(s){return typeof s=="function"}function U(s,e){return s!=s?e==e:s!==e||s&&typeof s=="object"||typeof s=="function"}function W(s){return Object.keys(s).length===0}function $(s,...e){if(s==null)return M;const t=s.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function he(s,e,t){s.$$.on_destroy.push($(e,t))}function ge(s,e){s.appendChild(e)}function ce(s,e,t){s.insertBefore(e,t||null)}function v(s){s.parentNode.removeChild(s)}function ne(s){return document.createElement(s)}function J(s){return document.createTextNode(s)}function be(){return J(" ")}function oe(s,e,t,r){return s.addEventListener(e,t,r),()=>s.removeEventListener(e,t,r)}function le(s,e,t){t==null?s.removeAttribute(e):s.getAttribute(e)!==t&&s.setAttribute(e,t)}function Y(s){return Array.from(s.childNodes)}function de(s,e){for(let t=0;t<s.options.length;t+=1){const r=s.options[t];if(r.__value===e){r.selected=!0;return}}s.selectedIndex=-1}function ue(s){const e=s.querySelector(":checked")||s.options[0];return e&&e.__value}let O;function L(s){O=s}function j(){if(!O)throw new Error("Function called outside component initialization");return O}function ke(s){j().$$.on_mount.push(s)}const F=[],T=[],P=[],w=[],q=Promise.resolve();let H=!1;function z(){H||(H=!0,q.then(Z))}function N(s){P.push(s)}let V=!1;const y=new Set;function Z(){if(!V){V=!0;do{for(let s=0;s<F.length;s+=1){const e=F[s];L(e),G(e.$$)}for(L(null),F.length=0;T.length;)T.pop()();for(let s=0;s<P.length;s+=1){const e=P[s];y.has(e)||(y.add(e),e())}P.length=0}while(F.length);for(;w.length;)w.pop()();H=!1,V=!1,y.clear()}}function G(s){if(s.fragment!==null){s.update(),D(s.before_update);const e=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,e),s.after_update.forEach(N)}}const x=new Set;let K;function Q(s,e){s&&s.i&&(x.delete(s),s.i(e))}function Ce(s,e,t,r){if(s&&s.o){if(x.has(s))return;x.add(s),K.c.push(()=>{x.delete(s),r&&(t&&s.d(1),r())}),s.o(e)}}function Me(s){s&&s.c()}function ee(s,e,t,r){const{fragment:a,on_mount:A,on_destroy:u,after_update:n}=s.$$;a&&a.m(e,t),r||N(()=>{const c=A.map(R).filter(I);u?u.push(...c):D(c),s.$$.on_mount=[]}),n.forEach(N)}function te(s,e){const t=s.$$;t.fragment!==null&&(D(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function se(s,e){s.$$.dirty[0]===-1&&(F.push(s),z(),s.$$.dirty.fill(0)),s.$$.dirty[e/31|0]|=1<<e%31}function fe(s,e,t,r,a,A,u,n=[-1]){const c=O;L(s);const i=s.$$={fragment:null,ctx:null,props:A,update:M,not_equal:a,bound:_(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:_(),dirty:n,skip_bound:!1,root:e.target||c.$$.root};u&&u(i.root);let E=!1;if(i.ctx=t?t(s,e.props||{},(d,m,...k)=>{const B=k.length?k[0]:m;return i.ctx&&a(i.ctx[d],i.ctx[d]=B)&&(!i.skip_bound&&i.bound[d]&&i.bound[d](B),E&&se(s,d)),m}):[],i.update(),E=!0,D(i.before_update),i.fragment=r?r(i.ctx):!1,e.target){if(e.hydrate){const d=Y(e.target);i.fragment&&i.fragment.l(d),d.forEach(v)}else i.fragment&&i.fragment.c();e.intro&&Q(s.$$.fragment),ee(s,e.target,e.anchor,e.customElement),Z()}L(c)}class Ae{$destroy(){te(this,1),this.$destroy=M}$on(e,t){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const a=r.indexOf(t);a!==-1&&r.splice(a,1)}}$set(e){this.$$set&&!W(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const S=[];function re(s,e){return{subscribe:ae(s,e).subscribe}}function ae(s,e=M){let t;const r=new Set;function a(n){if(U(s,n)&&(s=n,t)){const c=!S.length;for(const i of r)i[1](),S.push(i,s);if(c){for(let i=0;i<S.length;i+=2)S[i][0](S[i+1]);S.length=0}}}function A(n){a(n(s))}function u(n,c=M){const i=[n,c];return r.add(i),r.size===1&&(t=e(a)||M),n(s),()=>{r.delete(i),r.size===0&&(t(),t=null)}}return{set:a,update:A,subscribe:u}}function pe(s,e,t){const r=!Array.isArray(s),a=r?[s]:s,A=e.length<2;return re(t,u=>{let n=!1;const c=[];let i=0,E=M;const d=()=>{if(i)return;E();const k=e(r?c[0]:c,u);A?u(k):E=I(k)?k:M},m=a.map((k,B)=>$(k,X=>{c[B]=X,i&=~(1<<B),n&&d()},()=>{i|=1<<B}));return n=!0,d(),function(){D(m),E()}})}function h(s){return typeof s=="bigint"?Number(0xffn&s):255&s}function g(s){return typeof s=="bigint"?Number(0xffffn&s):65535&s}class f{static get(e,t){return(e&1<<t)!=0}static set(e,t,r){return h(r?e|1<<t:e&~(1<<t))}static countOnes(e){let t=0;for(;e;)t+=1&e,e>>=1;return t}}class C{static getCycles(e){return C.OP_CYCLES_TABLE[e]}static toString(e){return C.ASM_TABLE[e]}}C.OP_CYCLES_TABLE=[4,10,7,5,5,5,7,4,4,10,7,5,5,5,7,4,4,10,7,5,5,5,7,4,4,10,7,5,5,5,7,4,4,10,16,5,5,5,7,4,4,10,16,5,5,5,7,4,4,10,13,5,10,10,10,4,4,10,13,5,5,5,7,4,5,5,5,5,5,5,7,5,5,5,5,5,5,5,7,5,5,5,5,5,5,5,7,5,5,5,5,5,5,5,7,5,5,5,5,5,5,5,7,5,5,5,5,5,5,5,7,5,7,7,7,7,7,7,7,7,5,5,5,5,5,5,7,5,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,5,10,10,10,11,11,7,11,5,10,10,10,11,17,7,11,5,10,10,10,11,11,7,11,5,10,10,10,11,17,7,11,5,10,10,18,11,11,7,11,5,5,10,5,11,17,7,11,5,10,10,4,11,11,7,11,5,5,10,4,11,17,7,11],C.ASM_TABLE={0:"NOP",1:"LXI BC",2:"STAX BC",3:"INX BC",4:"INR B",5:"DCR B",6:"MVI B",7:"RLC",8:"NOP",9:"DAD BC",10:"LDAX BC",11:"DCX BC",12:"INR C",13:"DCR C",14:"MVI C",15:"RRC",16:"NOP",17:"LXI DE",18:"STAX DE",19:"INX DE",20:"INR D",21:"DCR D",22:"MVI D",23:"RAL",24:"NOP",25:"DAD DE",26:"LDAX DE",27:"DCX DE",28:"INR E",29:"DCR E",30:"MVI E",31:"RAR",32:"NOP",33:"LXI HL",34:"SHLD",35:"INX HL",36:"INR H",37:"DCR H",38:"MVI H",39:"DAA",40:"NOP",41:"DAD HL",42:"LHLD",43:"DCX HL",44:"INR L",45:"DCR L",46:"MVI L",47:"CMA",48:"NOP",49:"LXI SP",50:"STA",51:"INX SP",52:"INR M",53:"DCR M",54:"MVI M",55:"STC",56:"NOP",57:"DAD SP",58:"LDA",59:"DCX SP",60:"INR A",61:"DCR A",62:"MVI A",63:"CMC",64:"MOV (B, B)",65:"MOV (B, C)",66:"MOV (B, D)",67:"MOV (B, E)",68:"MOV (B, H)",69:"MOV (B, L)",70:"MOV (B, M)",71:"MOV (B, A)",72:"MOV (C, B)",73:"MOV (C, C)",74:"MOV (C, D)",75:"MOV (C, E)",76:"MOV (C, H)",77:"MOV (C, L)",78:"MOV (C, M)",79:"MOV (C, A)",80:"MOV (D, B)",81:"MOV (D, C)",82:"MOV (D, D)",83:"MOV (D, E)",84:"MOV (D, H)",85:"MOV (D, L)",86:"MOV (D, M)",87:"MOV (D, A)",88:"MOV (E, B)",89:"MOV (E, C)",90:"MOV (E, D)",91:"MOV (E, E)",92:"MOV (E, H)",93:"MOV (E, L)",94:"MOV (E, M)",95:"MOV (E, A)",96:"MOV (H, B)",97:"MOV (H, C)",98:"MOV (H, D)",99:"MOV (H, E)",100:"MOV (H, H)",101:"MOV (H, L)",102:"MOV (H, M)",103:"MOV (H, A)",104:"MOV (L, B)",105:"MOV (L, C)",106:"MOV (L, D)",107:"MOV (L, E)",108:"MOV (L, H)",109:"MOV (L, L)",110:"MOV (L, M)",111:"MOV (L, A)",112:"MOV (M, B)",113:"MOV (M, C)",114:"MOV (M, D)",115:"MOV (M, E)",116:"MOV (M, H)",117:"MOV (M, L)",118:"HLT",119:"MOV (M, A)",120:"MOV (A, B)",121:"MOV (A, C)",122:"MOV (A, D)",123:"MOV (A, E)",124:"MOV (A, H)",125:"MOV (A, L)",126:"MOV (A, M)",127:"MOV (A, A)",128:"ADD B",129:"ADD C",130:"ADD D",131:"ADD E",132:"ADD H",133:"ADD L",134:"ADD M",135:"ADD A",136:"ADC B",137:"ADC C",138:"ADC D",139:"ADC E",140:"ADC H",141:"ADC L",142:"ADC M",143:"ADC A",144:"SUB B",145:"SUB C",146:"SUB D",147:"SUB E",148:"SUB H",149:"SUB L",150:"SUB M",151:"SUB A",152:"SBB B",153:"SBB C",154:"SBB D",155:"SBB E",156:"SBB H",157:"SBB L",158:"SBB M",159:"SBB A",160:"ANA B",161:"ANA C",162:"ANA D",163:"ANA E",164:"ANA H",165:"ANA L",166:"ANA M",167:"ANA A",168:"XRA B",169:"XRA C",170:"XRA D",171:"XRA E",172:"XRA H",173:"XRA L",174:"XRA M",175:"XRA A",176:"ORA B",177:"ORA C",178:"ORA D",179:"ORA E",180:"ORA H",181:"ORA L",182:"ORA M",183:"ORA A",184:"CMP B",185:"CMP C",186:"CMP D",187:"CMP E",188:"CMP H",189:"CMP L",190:"CMP M",191:"CMP A",192:"RNZ",193:"POP BC",194:"JNZ",195:"JMP",196:"CNZ",197:"PUSH B",198:"ADI",199:"RST 0",200:"RZ",201:"RET",202:"JZ",203:"JMP",204:"CZ",205:"CALL",206:"ACI",207:"RST 1",208:"RNC",209:"POP DE",210:"JNC",211:"OUT",212:"CNC",213:"PUSH D",214:"SUI",215:"RST 2",216:"RC",217:"RET",218:"JC",219:"IN",220:"CC",221:"CALL",222:"SBI",223:"RST 3",224:"RPO",225:"POP HL",226:"JPO",227:"XTHL",228:"CPO",229:"PUSH H",230:"ANI",231:"RST 4",232:"RPE",233:"PCHL",234:"JPE",235:"XCHG",236:"CPE",237:"CALL",238:"XRI",239:"RST 5",240:"RP",241:"POP PSW",242:"JP",243:"DI",244:"CP",245:"PUSH PSW",246:"ORI",247:"RST 6",248:"RM",249:"SPHL",250:"JM",251:"EI",252:"CM",253:"CALL",254:"CPI",255:"RST 7"};class o{static toHexStr(e,t=2){const r=e.toString(16).toUpperCase();return r.startsWith("-")?"-"+r.substr(1).padStart(t,"0"):r.padStart(t,"0")}static printOperation(e,t){console.log(`[${o.toHexStr(t.reg.pc-1,4)}]  ${C.toString(e).padEnd(15," ")}(SP=${o.toHexStr(t.reg.sp,4)} A=${o.toHexStr(t.reg.a)} F=${o.toHexStr(t.reg.f)} B=${o.toHexStr(t.reg.b)} C=${o.toHexStr(t.reg.c)} D=${o.toHexStr(t.reg.d)} E=${o.toHexStr(t.reg.e)} H=${o.toHexStr(t.reg.h)} L=${o.toHexStr(t.reg.l)} FLAGS=`+(t.reg.getFlagS()?"S":".")+(t.reg.getFlagZ()?"Z":".")+(t.reg.getFlagA()?"A":".")+(t.reg.getFlagP()?"P":".")+(t.reg.getFlagC()?"C":".")+")")}}var l;(function(s){s[s.S=7]="S",s[s.Z=6]="Z",s[s.A=4]="A",s[s.P=2]="P",s[s.C=0]="C"})(l||(l={}));class ie{constructor(){this.a=0,this.f=2,this.b=0,this.c=0,this.d=0,this.e=0,this.h=0,this.l=0,this.sp=0,this.pc=0}getAF(){return g(this.a<<8|this.f)}getBC(){return g(this.b<<8|this.c)}getDE(){return g(this.d<<8|this.e)}getHL(){return g(this.h<<8|this.l)}setAF(e){this.a=h(e>>8),this.f=h(213&e|2)}setBC(e){this.b=h(e>>8),this.c=h(255&e)}setDE(e){this.d=h(e>>8),this.e=h(255&e)}setHL(e){this.h=h(e>>8),this.l=h(255&e)}setFlag(e,t){this.f=f.set(this.f,e,t)}getFlag(e){return f.get(this.f,e)}setFlagS(e){this.setFlag(l.S,f.get(e,7))}setFlagZ(e){this.setFlag(l.Z,e==0)}setFlagA(e){this.setFlag(l.A,e)}setFlagP(e){this.setFlag(l.P,(1&f.countOnes(e))==0)}setFlagC(e){this.setFlag(l.C,e)}getFlagS(){return this.getFlag(l.S)}getFlagZ(){return this.getFlag(l.Z)}getFlagA(){return this.getFlag(l.A)}getFlagP(){return this.getFlag(l.P)}getFlagC(){return this.getFlag(l.C)}}class b{constructor(e,t,r=!1){this.reg=new ie,this.mem=void 0,this.halted=!1,this.intEnabled=!1,this.debugEnabled=!1,this.device=void 0,this.stepCycles=0,this.stepZero=Date.now(),this.mem=e,this.device=t,this.debugEnabled=r}next(){if(this.halted)return 0;const e=this.getNextByte();this.debugEnabled&&o.printOperation(e,this);let t=0;switch(e){case 0:case 8:case 16:case 24:case 32:case 40:case 48:case 56:case 64:case 73:case 82:case 91:case 100:case 109:case 127:break;case 63:this.reg.setFlagC(!this.reg.getFlagC());break;case 55:this.reg.setFlagC(!0);break;case 4:this.reg.b=this.inr(this.reg.b);break;case 12:this.reg.c=this.inr(this.reg.c);break;case 20:this.reg.d=this.inr(this.reg.d);break;case 28:this.reg.e=this.inr(this.reg.e);break;case 36:this.reg.h=this.inr(this.reg.h);break;case 44:this.reg.l=this.inr(this.reg.l);break;case 52:{const r=this.getM(),a=this.inr(r);this.setM(a);break}case 60:this.reg.a=this.inr(this.reg.a);break;case 5:this.reg.b=this.dcr(this.reg.b);break;case 13:this.reg.c=this.dcr(this.reg.c);break;case 21:this.reg.d=this.dcr(this.reg.d);break;case 29:this.reg.e=this.dcr(this.reg.e);break;case 37:this.reg.h=this.dcr(this.reg.h);break;case 45:this.reg.l=this.dcr(this.reg.l);break;case 53:{const r=this.getM(),a=this.dcr(r);this.setM(a);break}case 61:this.reg.a=this.dcr(this.reg.a);break;case 47:this.reg.a=h(~this.reg.a);break;case 39:this.daa();break;case 65:this.reg.b=this.reg.c;break;case 66:this.reg.b=this.reg.d;break;case 67:this.reg.b=this.reg.e;break;case 68:this.reg.b=this.reg.h;break;case 69:this.reg.b=this.reg.l;break;case 70:this.reg.b=this.getM();break;case 71:this.reg.b=this.reg.a;break;case 72:this.reg.c=this.reg.b;break;case 74:this.reg.c=this.reg.d;break;case 75:this.reg.c=this.reg.e;break;case 76:this.reg.c=this.reg.h;break;case 77:this.reg.c=this.reg.l;break;case 78:this.reg.c=this.getM();break;case 79:this.reg.c=this.reg.a;break;case 80:this.reg.d=this.reg.b;break;case 81:this.reg.d=this.reg.c;break;case 83:this.reg.d=this.reg.e;break;case 84:this.reg.d=this.reg.h;break;case 85:this.reg.d=this.reg.l;break;case 86:this.reg.d=this.getM();break;case 87:this.reg.d=this.reg.a;break;case 88:this.reg.e=this.reg.b;break;case 89:this.reg.e=this.reg.c;break;case 90:this.reg.e=this.reg.d;break;case 92:this.reg.e=this.reg.h;break;case 93:this.reg.e=this.reg.l;break;case 94:this.reg.e=this.getM();break;case 95:this.reg.e=this.reg.a;break;case 96:this.reg.h=this.reg.b;break;case 97:this.reg.h=this.reg.c;break;case 98:this.reg.h=this.reg.d;break;case 99:this.reg.h=this.reg.e;break;case 101:this.reg.h=this.reg.l;break;case 102:this.reg.h=this.getM();break;case 103:this.reg.h=this.reg.a;break;case 104:this.reg.l=this.reg.b;break;case 105:this.reg.l=this.reg.c;break;case 106:this.reg.l=this.reg.d;break;case 107:this.reg.l=this.reg.e;break;case 108:this.reg.l=this.reg.h;break;case 110:this.reg.l=this.getM();break;case 111:this.reg.l=this.reg.a;break;case 112:this.setM(this.reg.b);break;case 113:this.setM(this.reg.c);break;case 114:this.setM(this.reg.d);break;case 115:this.setM(this.reg.e);break;case 116:this.setM(this.reg.h);break;case 117:this.setM(this.reg.l);break;case 119:this.setM(this.reg.a);break;case 120:this.reg.a=this.reg.b;break;case 121:this.reg.a=this.reg.c;break;case 122:this.reg.a=this.reg.d;break;case 123:this.reg.a=this.reg.e;break;case 124:this.reg.a=this.reg.h;break;case 125:this.reg.a=this.reg.l;break;case 126:this.reg.a=this.getM();break;case 2:this.mem.set(this.reg.getBC(),this.reg.a);break;case 18:this.mem.set(this.reg.getDE(),this.reg.a);break;case 10:this.reg.a=this.mem.get(this.reg.getBC());break;case 26:this.reg.a=this.mem.get(this.reg.getDE());break;case 128:this.add(this.reg.b);break;case 129:this.add(this.reg.c);break;case 130:this.add(this.reg.d);break;case 131:this.add(this.reg.e);break;case 132:this.add(this.reg.h);break;case 133:this.add(this.reg.l);break;case 134:this.add(this.getM());break;case 135:this.add(this.reg.a);break;case 136:this.adc(this.reg.b);break;case 137:this.adc(this.reg.c);break;case 138:this.adc(this.reg.d);break;case 139:this.adc(this.reg.e);break;case 140:this.adc(this.reg.h);break;case 141:this.adc(this.reg.l);break;case 142:this.adc(this.getM());break;case 143:this.adc(this.reg.a);break;case 144:this.sub(this.reg.b);break;case 145:this.sub(this.reg.c);break;case 146:this.sub(this.reg.d);break;case 147:this.sub(this.reg.e);break;case 148:this.sub(this.reg.h);break;case 149:this.sub(this.reg.l);break;case 150:this.sub(this.getM());break;case 151:this.sub(this.reg.a);break;case 152:this.sbb(this.reg.b);break;case 153:this.sbb(this.reg.c);break;case 154:this.sbb(this.reg.d);break;case 155:this.sbb(this.reg.e);break;case 156:this.sbb(this.reg.h);break;case 157:this.sbb(this.reg.l);break;case 158:this.sbb(this.getM());break;case 159:this.sbb(this.reg.a);break;case 160:this.ana(this.reg.b);break;case 161:this.ana(this.reg.c);break;case 162:this.ana(this.reg.d);break;case 163:this.ana(this.reg.e);break;case 164:this.ana(this.reg.h);break;case 165:this.ana(this.reg.l);break;case 166:this.ana(this.getM());break;case 167:this.ana(this.reg.a);break;case 168:this.xra(this.reg.b);break;case 169:this.xra(this.reg.c);break;case 170:this.xra(this.reg.d);break;case 171:this.xra(this.reg.e);break;case 172:this.xra(this.reg.h);break;case 173:this.xra(this.reg.l);break;case 174:this.xra(this.getM());break;case 175:this.xra(this.reg.a);break;case 176:this.ora(this.reg.b);break;case 177:this.ora(this.reg.c);break;case 178:this.ora(this.reg.d);break;case 179:this.ora(this.reg.e);break;case 180:this.ora(this.reg.h);break;case 181:this.ora(this.reg.l);break;case 182:this.ora(this.getM());break;case 183:this.ora(this.reg.a);break;case 184:this.cmp(this.reg.b);break;case 185:this.cmp(this.reg.c);break;case 186:this.cmp(this.reg.d);break;case 187:this.cmp(this.reg.e);break;case 188:this.cmp(this.reg.h);break;case 189:this.cmp(this.reg.l);break;case 190:this.cmp(this.getM());break;case 191:this.cmp(this.reg.a);break;case 7:this.rlc();break;case 15:this.rrc();break;case 23:this.ral();break;case 31:this.rar();break;case 197:this.stackAdd(this.reg.getBC());break;case 213:this.stackAdd(this.reg.getDE());break;case 229:this.stackAdd(this.reg.getHL());break;case 245:this.stackAdd(this.reg.getAF());break;case 193:this.reg.setBC(this.stackPop());break;case 209:this.reg.setDE(this.stackPop());break;case 225:this.reg.setHL(this.stackPop());break;case 241:this.reg.setAF(this.stackPop());break;case 9:this.dad(this.reg.getBC());break;case 25:this.dad(this.reg.getDE());break;case 41:this.dad(this.reg.getHL());break;case 57:this.dad(this.reg.sp);break;case 3:this.reg.setBC(g(this.reg.getBC()+1));break;case 19:this.reg.setDE(g(this.reg.getDE()+1));break;case 35:this.reg.setHL(g(this.reg.getHL()+1));break;case 51:this.reg.sp=g(this.reg.sp+1);break;case 11:this.reg.setBC(g(this.reg.getBC()-1));break;case 27:this.reg.setDE(g(this.reg.getDE()-1));break;case 43:this.reg.setHL(g(this.reg.getHL()-1));break;case 59:this.reg.sp=g(this.reg.sp-1);break;case 235:{const r=this.reg.h;this.reg.h=this.reg.d,this.reg.d=r;const a=this.reg.l;this.reg.l=this.reg.e,this.reg.e=a;break}case 227:{const r=this.mem.getWord(this.reg.sp),a=this.reg.getHL();this.reg.setHL(r),this.mem.setWord(this.reg.sp,a);break}case 249:this.reg.sp=this.reg.getHL();break;case 1:this.reg.setBC(this.getNextWord());break;case 17:this.reg.setDE(this.getNextWord());break;case 33:this.reg.setHL(this.getNextWord());break;case 49:this.reg.sp=this.getNextWord();break;case 6:this.reg.b=this.getNextByte();break;case 14:this.reg.c=this.getNextByte();break;case 22:this.reg.d=this.getNextByte();break;case 30:this.reg.e=this.getNextByte();break;case 38:this.reg.h=this.getNextByte();break;case 46:this.reg.l=this.getNextByte();break;case 54:this.setM(this.getNextByte());break;case 62:this.reg.a=this.getNextByte();break;case 198:this.add(this.getNextByte());break;case 206:this.adc(this.getNextByte());break;case 214:this.sub(this.getNextByte());break;case 222:this.sbb(this.getNextByte());break;case 230:this.ana(this.getNextByte());break;case 238:this.xra(this.getNextByte());break;case 246:this.ora(this.getNextByte());break;case 254:this.cmp(this.getNextByte());break;case 50:this.mem.set(this.getNextWord(),this.reg.a);break;case 58:this.reg.a=this.mem.get(this.getNextWord());break;case 34:this.mem.setWord(this.getNextWord(),this.reg.getHL());break;case 42:this.reg.setHL(this.mem.getWord(this.getNextWord()));break;case 233:this.reg.pc=this.reg.getHL();break;case 195:case 218:case 210:case 202:case 194:case 250:case 242:case 234:case 226:{const r=this.getNextWord();this.checkBranchCondition(e)&&(this.reg.pc=r);break}case 205:case 220:case 212:case 204:case 196:case 236:case 228:case 252:case 244:{const r=this.getNextWord();this.checkBranchCondition(e)&&(t=6,this.stackAdd(this.reg.pc),this.reg.pc=r);break}case 201:case 216:case 208:case 200:case 192:case 248:case 240:case 232:case 224:this.checkBranchCondition(e)&&(t=6,this.reg.pc=this.stackPop());break;case 199:case 207:case 215:case 223:case 231:case 239:case 247:case 255:this.stackAdd(this.reg.pc),this.reg.pc=g(56&e);break;case 251:this.intEnabled=!0;break;case 243:this.intEnabled=!1;break;case 219:this.reg.a=this.device.input(this.getNextByte());break;case 211:this.device.output(this.getNextByte(),this.reg.a);break;case 118:this.halted=!0;break;default:throw new b.UnimplementedInstructionError(e)}return C.getCycles(e)+t}async step(){if(this.stepCycles>b.STEP_CYCLES){this.stepCycles-=b.STEP_CYCLES;const t=Date.now()-this.stepZero,r=b.STEP_TIME-t;await new Promise(a=>setTimeout(a,r)),this.stepZero=this.stepZero+b.STEP_TIME}const e=this.next();return this.stepCycles+=e,e}handleIntEnabled(e){this.intEnabled&&(this.intEnabled=!1,this.stackAdd(this.reg.pc),this.reg.pc=e,this.stepCycles+=C.getCycles(205))}getNextByte(){const e=this.mem.get(this.reg.pc);return this.reg.pc=g(this.reg.pc+1),e}getNextWord(){const e=this.mem.getWord(this.reg.pc);return this.reg.pc=g(this.reg.pc+2),e}getM(){const e=this.reg.getHL();return this.mem.get(e)}setM(e){const t=this.reg.getHL();this.mem.set(t,e)}stackAdd(e){this.reg.sp=g(this.reg.sp-2),this.mem.setWord(this.reg.sp,e)}stackPop(){const e=this.mem.getWord(this.reg.sp);return this.reg.sp=g(this.reg.sp+2),e}checkBranchCondition(e){switch(e){case 195:case 205:case 201:return!0;case 218:case 220:case 216:return this.reg.getFlagC();case 210:case 212:case 208:return!this.reg.getFlagC();case 202:case 204:case 200:return this.reg.getFlagZ();case 194:case 196:case 192:return!this.reg.getFlagZ();case 250:case 252:case 248:return this.reg.getFlagS();case 242:case 244:case 240:return!this.reg.getFlagS();case 234:case 236:case 232:return this.reg.getFlagP();case 226:case 228:case 224:return!this.reg.getFlagP();default:throw new b.UnimplementedInstructionError(e)}}inr(e){const t=h(e+1);return this.reg.setFlagS(t),this.reg.setFlagZ(t),this.reg.setFlagP(t),this.reg.setFlagA(1+(15&e)>15),t}dcr(e){const t=h(e-1);return this.reg.setFlagS(t),this.reg.setFlagZ(t),this.reg.setFlagP(t),this.reg.setFlagA((15&t)!=15),t}daa(){let e=0,t=this.reg.getFlagC();const r=15&this.reg.a,a=this.reg.a>>4&15;(r>9||this.reg.getFlagA())&&(e=h(e+6)),(a>9||this.reg.getFlagC()||a>=9&&r>9)&&(e=h(e+96),t=!0),this.add(e),this.reg.setFlagC(t)}add(e){const t=this.reg.a,r=h(t+e);this.reg.setFlagS(r),this.reg.setFlagZ(r),this.reg.setFlagP(r),this.reg.setFlagA((15&t)+(15&e)>15),this.reg.setFlagC(t+e>255),this.reg.a=r}adc(e){const t=+this.reg.getFlagC(),r=this.reg.a,a=h(r+e+t);this.reg.setFlagS(a),this.reg.setFlagZ(a),this.reg.setFlagP(a),this.reg.setFlagA((15&r)+(15&e)+t>15),this.reg.setFlagC(r+e+t>255),this.reg.a=a}sub(e){const t=this.reg.a,r=h(t-e);this.reg.setFlagS(r),this.reg.setFlagZ(r),this.reg.setFlagP(r),this.reg.setFlagA((15&t)-(15&e)>=0),this.reg.setFlagC(t<e),this.reg.a=r}sbb(e){const t=+this.reg.getFlagC(),r=this.reg.a,a=h(r-e-t);this.reg.setFlagS(a),this.reg.setFlagZ(a),this.reg.setFlagP(a),this.reg.setFlagA((15&r)-(15&e)-t>=0),this.reg.setFlagC(r<e+t),this.reg.a=a}ana(e){const t=h(this.reg.a&e);this.reg.setFlagS(t),this.reg.setFlagZ(t),this.reg.setFlagP(t),this.reg.setFlagA((8&(this.reg.a|e))!=0),this.reg.setFlagC(!1),this.reg.a=t}xra(e){const t=h(this.reg.a^e);this.reg.setFlagS(t),this.reg.setFlagZ(t),this.reg.setFlagP(t),this.reg.setFlagA(!1),this.reg.setFlagC(!1),this.reg.a=t}ora(e){const t=h(this.reg.a|e);this.reg.setFlagS(t),this.reg.setFlagZ(t),this.reg.setFlagP(t),this.reg.setFlagA(!1),this.reg.setFlagC(!1),this.reg.a=t}cmp(e){const t=this.reg.a;this.sub(e),this.reg.a=t}rlc(){const e=f.get(this.reg.a,7),t=h(this.reg.a<<1|+e);this.reg.setFlagC(e),this.reg.a=t}rrc(){const e=f.get(this.reg.a,0),t=h(e?128|this.reg.a>>1:this.reg.a>>1);this.reg.setFlagC(e),this.reg.a=t}ral(){const e=f.get(this.reg.a,7),t=h(this.reg.a<<1|+this.reg.getFlagC());this.reg.setFlagC(e),this.reg.a=t}rar(){const e=f.get(this.reg.a,0),t=this.reg.getFlagC()?h(128|this.reg.a>>1):h(this.reg.a>>1);this.reg.setFlagC(e),this.reg.a=t}dad(e){const t=this.reg.getHL(),r=g(t+e);this.reg.setFlagC(t>65535-e),this.reg.setHL(r)}}b.CLOCK_FREQUENCY=2e6,b.STEP_TIME=16,b.STEP_CYCLES=b.STEP_TIME/(1e3/b.CLOCK_FREQUENCY),function(s){class e extends Error{constructor(r){super(`Unimplemented instruction: ${C.toString(r)} (0x${o.toHexStr(r)})`),this.opcode=void 0,this.opcode=r}}s.UnimplementedInstructionError=e}(b||(b={}));class p{constructor(){this.data=new ArrayBuffer(p.MEMORY_SIZE),this.view=new DataView(this.data)}load(e,t=0){for(let r=0;r<e.length;r++){if(t+r>=p.MEMORY_SIZE)throw new p.NotEnoughMemoryError;this.set(g(t+r),h(e[r]))}}get(e){return this.view.getUint8(e)}set(e,t){this.view.setUint8(e,t)}getWord(e){return this.view.getUint16(e,!0)}setWord(e,t){this.view.setUint16(e,t,!0)}}p.MEMORY_SIZE=65536,function(s){class e extends Error{constructor(){super("Not enough memory for this operation!")}}s.NotEnoughMemoryError=e}(p||(p={}));export{p as A,b as B,Ae as S,fe as a,be as b,le as c,pe as d,ne as e,ce as f,ge as g,M as h,g as i,v as j,T as k,oe as l,N as m,h as n,ke as o,de as p,he as q,D as r,U as s,ue as t,Me as u,ee as v,ae as w,Q as x,Ce as y,te as z};
